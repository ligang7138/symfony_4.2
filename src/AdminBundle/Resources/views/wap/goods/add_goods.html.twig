<style>
    .checkbox-custom, .radio-custom{
        margin-top: 0;
    }
    .chosen-select{
        width: 100%;
    }
    #pr_photo_file,#pr_photo_file_del{
        position: relative;
        display: inline-block;
        background: #D0EEFF;
        border: 1px solid #99D3F5;
        border-radius: 4px;
        padding: 4px 12px;
        overflow: hidden;
        color: #1E88C7;
        text-decoration: none;
        text-indent: 0;
        line-height: 20px;
    }
    #pr_photo_file #goods_photo {
        position: absolute;
        font-size: 100px;
        right: 0;
        top: 0;
        opacity: 0;
    }
    #pr_photo_file_del #del_photo {
        position: absolute;
        font-size: 100px;
        right: 0;
        top: 0;
        opacity: 0;
    }
    #pr_photo_file:hover,#pr_photo_file_del:hover {
        background: #AADFFD;
        border-color: #78C3F3;
        color: #004974;
        text-decoration: none;
    }
</style>
<div class="page-content" id="photo_box">
    <div class="row">
        <div class="col-md-12">
            <div class="panel" id="exampleWizardForm">
                <div class="panel-heading">
                    <h3 class="panel-title">{% if gId %}编辑{% else %}添加{% endif %}商品</h3>
                </div>
                <div class="panel-body">
                    <div class="example">
                        <div class="pearls row">
                            <div class="pearl col-xs-3 done current">
                                <span class="pearl-number">1</span> <span class="pearl-title">选择商品分类</span>
                            </div>
                            <div class="pearl col-xs-3 disabled">
                                <span class="pearl-number">2</span> <span class="pearl-title">商品基本信息</span>
                            </div>
                            <div class="pearl col-xs-3 disabled">
                                <span class="pearl-number">3</span> <span class="pearl-title">商品详情信息</span>
                            </div>
                            <div class="pearl col-xs-3 disabled">
                                <span class="pearl-number">4</span> <span class="pearl-title">提交审核</span>
                            </div>
                        </div>
                    </div>
                    <form id="goods_photo_form" method="post">
                        <input type="hidden" name="content" id="goods_photo_">
                        <input type="hidden" id="goods_ext" name="ext" value="">
                    </form>
                    <form class="form-horizontal m-t wizard-content" action="/goods/edit_goods/0.html" method="post" id="addGoodsForm" onsubmit="fsubmit(this);return false;">
                        <div class="wizard-pane active" id="exampleAccount" role="tabpanel">
                            <div id="exampleAccountForm" class="form-horizontal m-t">
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">选择商品分类</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix">
                                        <label class="col-sm-2 control-label text-right">一级分类:</label>
                                        <div class="col-sm-2">
                                            <select name="gc_first_id" id="classification1" class="chosen-select" data-rule-required="true" onchange="selectJudge($(this),$('.btn_next_one'));" {% if (goods_data.gStatus != '') and goods_data.gStatus !=3 %}disabled{% endif %}>
                                                <option value="-1">--请选择一级分类--</option>
                                                {% for key,val in top_level %}
                                                    <option value="{{ val.gcId }}" {% if val.gcId == gcInfos.firstId %}selected{% endif %}>{{ val.gcName }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <label class="col-sm-2 control-label text-right">二级分类:</label>
                                        <div class="col-sm-2">
                                            <select name="gc_second_id" id="classification2" class="chosen-select" data-rule-required="true" {% if (goods_data.gStatus != '') and (goods_data.gStatus !=3) %}disabled{% endif %}>
                                                <option value="0">--请选择二级分类--</option>
                                            </select>
                                        </div>
                                        <label class="col-sm-2 control-label text-right">三级分类:</label>
                                        <div class="col-sm-2">
                                            <select name="gc_three_id" id="classification3" class="chosen-select" data-rule-required="true" {% if (goods_data.gStatus != '') and (goods_data.gStatus !=3) %}disabled{% endif %}>
                                                <option value="0">--请选择三级分类--</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel">
                                    <div class="panel-body container-fluid">
                                        <div class="col-sm-12 col-sm-offset-3" style="margin: 20px 0;text-align: center;">
                                            <button class="btn btn-primary btn_next btn_next_one" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">确认，下一步</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-pane" id="exampleBilling" role="tabpanel">
                            <div id="exampleBillingForm">
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">基本信息</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix">
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品名称:</label>
                                            <div class="col-sm-3">
                                                <input type="text" name="g_name" value="{{ goods_data.gName }}" class="form-control" placeholder="请输入" required aria-required="true" maxlength="20" {% if (atype == 0 and goods_data.gStatus != '' and goods_data.gStatus !=3) or (atype != 0 and goods_data.gStatus != '') %}disabled{% endif %}>
                                                <input type="hidden" name="g_id" value="{{ goods_data.gId }}" />
                                                <input type="hidden" name="g_code" value="{{ goods_data.gCode }}" />
                                                {% if (atype == 0 and goods_data.gStatus != '' and goods_data.gStatus !=3) or (atype != 0 and goods_data.gStatus != '') %}
                                                    <input type="hidden" name="g_name" value="{{ goods_data.gName }}" />
                                                    <input type="hidden" name="gb_id" value="{{ goods_data.gbId }}" />
                                                    <input type="hidden" name="gc_first_id" value="{{ gcInfos.firstId }}" />
                                                    <input type="hidden" name="gc_second_id" value="{{ gcInfos.secongId }}" />
                                                    <input type="hidden" name="gc_three_id" value="{{ gcInfos.threeId }}" />
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品品牌:</label>
                                            <div class="col-sm-3">
                                                <select name="gb_id" id="goods_brand_id" class="chosen-select" data-rule-required="true" onchange="selectJudge($(this),$('.btn_next_two'));" {% if (goods_data.gStatus != '') and (goods_data.gStatus !=3) %}disabled{% endif %}>
                                                    <option value="0">--请选择品牌--</option>
                                                    {% for binfo in brand_info %}
                                                        <option value="{{ binfo.gbId }}"
                                                                {% if goods_data.gbId == binfo.gbId %}selected{% endif %}>{{ binfo.gbName }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品头图:</label>
                                            <div class="col-md-10">
                                                <div class="form-group file_list clearfix">
                                                    <div class="col-sm-8">
                                                        <a href="javascript:;" id="pr_photo_file">
                                                            <input type="file" accept="image/*" name="file_" id="goods_photo" onchange="goods_upload(event);">
                                                            选择图片
                                                        </a>
                                                        <a href="javascript:;" id="pr_photo_file_del">
                                                            <input type="input" {% if goods_data.gImgs %}{% else %}disabled{% endif %}  name="del_file" id="del_photo" onclick="gdel_upload();">
                                                            删除图片
                                                        </a>
                                                        <img width="300" height="300" style="display: {% if goods_data.gImgs %}block{% else %}none{% endif %};" id="goods_photo_src"  src="{{ admin_bundle.fileHost }}{{ goods_data.gImgs }}"/>
                                                        <input type="hidden" id="goodsHeadImg" name="goodsHeadImg" value="{{ goods_data.gImgs }}">
                                                    </div>
                                                    <label class="col-sm-10 control-text"><span style="font-size: 13px;font-weight: 500;">图片上传要求：单张图片小于10M，此处只能添加一张图片；图片格式支持JPG、JPEG、PNG格式。</span></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品图片:</label>
                                            <div class="col-md-10">
                                                <div class="form-group file_list clearfix">
                                                    <div class="margin-left-10 gallerys filelist_{{ goods_data.gId | default(0) }}_d">
                                                        {% for d in goods_image['d'] %}
                                                            <div class="file-box">
                                                                <span class="cancel" id='delCancel' data-id="{{ d.id }}" data-type="{{ d.pd_type }}">删除</span>
                                                                <div class="file">
                                                                    <span class="corner"></span>
                                                                    <div class="image imgWrap">
                                                                        <img alt="image"  class="gallery-pic active img-responsive center-block" src="{{ admin_bundle.fileHost }}{{d.pd_url}}" onclick="openPhotoWin(this)">
                                                                    </div>
                                                                    <div class="file-name">
                                                                        {{ attribute(admin_bundle.file_type,d.pd_type) }}-{{ loop.index }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                        <div class="file-box" style="width: 140px !important;">
                                                            {#<span class="cancel goodsdelGcate" >删除</span>#}
                                                            <div class="file">
                                                                <a href="javascript:void(0);" onclick="mopen('/upload/upload.html?p_id={{ goods_data.gId | default(0) }}&f_type=d','资料图片上传',null,['750px','auto']);">
                                                                    <span class="corner"></span>
                                                                    <div class="image">
                                                                        <img alt="image" class="img-responsive center-block" width="100%" src="/public/img/upload.png">
                                                                    </div>
                                                                    <div class="file-name">
                                                                        商品图片
                                                                    </div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <label class="col-sm-8 control-text col-sm-offset-2"><span style="font-size: 13px;font-weight: 500;">图片上传要求：单张图片小于10M，此处只能添加三张图片；图片格式支持JPG、JPEG、PNG格式。</span></label>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品描述:</label>
                                            <div class="col-sm-8 control-text">
                                                <textarea name="g_desc" maxlength="100" class="form-control col-sm-3" id="textareaDefault" rows="3" required aria-required="true">{{ goods_data.gDesc }}</textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">活动信息</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix">
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right" style="font-size: 17px;">满减活动</label>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>是否参与:</label>
                                            <div class="col-sm-5">
                                                <div class="example-wrap">
                                                    <div class="radio-custom radio-primary col-sm-5">
                                                        <input type="radio" name="is_join_activity" {% if goods_data.isJoinActivity==1 %}checked{% endif %} value="1" />
                                                        <label for="inputUnchecked">参与</label>
                                                    </div>
                                                    <div class="radio-custom radio-primary col-sm-5">
                                                        <input type="radio" name="is_join_activity" {% if goods_data.isJoinActivity==2 %}checked{% endif %} value="2" />
                                                        <label for="inputChecked">不参与</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel">
                                    <div class="panel-body container-fluid">
                                        <div class="col-sm-12 col-sm-offset-3" style="margin: 20px 0;text-align: center;">
                                            <button class="btn btn-default btn_back" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">上一步</button>
                                            <button class="btn btn-primary btn_next btn_next_two" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">下一步</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-pane" id="exampleBilling" role="tabpanel">
                            <div id="exampleBillingForm">
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">商品属性</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix" id="xxl_gc_attribute"></div>
                                </div>
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">商品规格</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix">
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right"><span class="must">*</span>商品规格:</label>
                                            <div class="col-sm-7">
                                                <button type="button" class="btn btn-outline btn-primary" style="margin-bottom: 5px;" onclick="addSpec()">
                                                    <i class="icon wb-plus" aria-hidden="true"></i> 添加规格
                                                </button>
                                                <button type="button" class="btn btn-outline btn-primary" style="margin-bottom: 5px;" onclick="editSpec()">
                                                    <i class="icon wb-edit" aria-hidden="true"></i> 修改规格
                                                </button>
                                                <input type="hidden" name="g_standard" value="" id="g_standard" />
                                                <table class="xxlEditSpec table table-bordered table-hover dataTable table-striped width-full table_add Specifications_list">
                                                    <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th>规格类别</th>
                                                        <th>规格值</th>
                                                        <th>单价(元)</th>
                                                        <th>剩余库存值(件)</th>
                                                        <th>总库存值(件)</th>
                                                        <th>库存提醒值(件)</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="xxl_gnarr">
                                                    {% for pkey,pval in goods_spec %}
                                                        <tr>
                                                            <td><input type="checkbox" name="gn_id" value="{{ pval.gn_id }}"></td>
                                                            <td>{{ attribute(admin_bundle.spec_type,pval.gn_spec_type) }}</td>
                                                            <td>{{ pval.gn_spec_num }}/件</td>
                                                            <td>{{ pval.gn_price }}</td>
                                                            <td>{{ pval.gn_stock }}</td>
                                                            <td class="xxlgnStock">{{ pval.gn_total_stock }}</td>
                                                            <td>{{ pval.gn_stock_remind }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            <label class="col-sm-2 control-label text-right">单笔订单限购数量:</label>
                                            <div class="col-sm-4">
                                                <input type="text" name="g_order_num" class="form-control margin-right-10" value="{{ goods_data.gOrderNum }}" style="display: inline-block;width: 75%" />件
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel">
                                    <div class="panel-body container-fluid">
                                        <div class="col-sm-12 col-sm-offset-3" style="margin: 20px 0;text-align: center;">
                                            <button class="btn btn-default btn_back" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">上一步</button>
                                            <button class="btn btn-primary btn_next xxl_next" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">下一步</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-pane" id="exampleGetting" role="tabpanel">
                            <div id="exampleGettingForm">
                                <div class="form-group">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">其他信息</h3>
                                    </div>
                                    <div class="padding-20 padding-top-0 clearfix">
                                        <div class="form-bolck col-sm-12 padding-bottom-20">
                                            {% if goods_data.gStatus == '' or goods_data.gStatus ==3 %}
                                            <label class="col-sm-3 control-label text-right">上架时间:</label>
                                            <div class="col-sm-9">
                                                <div class="example-wrap">
                                                    <div class="radio-custom radio-primary col-sm-6 col-xs-12">
                                                        <input type="radio" name="g_status" value="4" {% if goods_data.gStatus == 4  %} checked {% endif %}>
                                                        <label for="inputUnchecked">审核通过后，立即自动上架</label>
                                                    </div>
                                                    <div class="radio-custom radio-primary col-sm-6 col-xs-12">
                                                        <input type="radio" name="g_status" value="1" {% if goods_data.gStatus == 1  %} checked {% endif %}>
                                                        <label for="inputChecked">审核通过后，手动操作上架</label>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <div class="col-sm-12 col-sm-offset-2 margin-top-30">
                                                <div class="checkbox-custom checkbox-primary">
                                                    <input type="checkbox" name="inputCheckboxes" checked>
                                                    <label>我已认真阅读<a href="/admin/agreement/2.html" target="_blank">《商品发布规格》</a>，并严格遵守</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel">
                                    <div class="panel-body container-fluid">
                                        <div class="col-sm-12 col-sm-offset-3" style="margin: 20px 0;text-align: center;">
                                            <button class="btn btn-default btn_back" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button">上一步</button>
                                            <button class="btn btn-primary" style="padding: 8px 26px;font-size:16px;margin-right: 30px" type="button" onclick="intopiece_submit();" >{% if gId %}保存{% else %}提交审核{% endif %}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        // 商品分类初始化信息
        {% if gcInfos.firstId %}
        getlowerLevel("{{ gcInfos.firstId }}","{{ gcInfos.secongId }}");
        getAttributeInfo("{{ gcInfos.firstId }}","{{ gId }}");
        {% endif %}
        {% if gcInfos.secongId %}
        getThreelowerLevel("{{ gcInfos.secongId }}","{{ gcInfos.threeId }}");
        {% endif %}

        var config = {
            ".chosen-select": {},
            ".chosen-select-deselect": {
                allow_single_deselect: !0
            },
            ".chosen-select-no-single": {
                disable_search_threshold: 10
            },
            ".chosen-select-no-results": {
                no_results_text: "Oops, nothing found!"
            },
            ".chosen-select-width": {
                width: "100%"
            }
        };
        for (var selector in config) $(selector).chosen(config[selector]);

        // input框失去焦点判断
        $("*[required]").parent().append('<span id="uei_operate_time-error" class="help-block m-b-none" style="display: none"><i class="fa fa-times-circle"></i>  必填</span>')

        selectJudge($('#classification1'),$('.btn_next_one'));
        selectJudge($('#goods_brand_id'),$('.btn_next_two'));
       //  判断商品添加是否被编辑
        var gid = "{{ gId }}";
        if( gid > 0 ){
            $('.btn_next_one').removeAttr("disabled")
        }else {
            $('.btn_next_one').attr({"disabled":"disabled"})
        }
    });

    //   下一步点击事件
    function next(btn) {
        if(btn){
            var index = btn.parents('.wizard-pane').index();
            btn.parents('.wizard-pane').next().addClass('active').siblings().removeClass('active');
        }else {
            var index = $('.active .btn_next').parents('.wizard-pane').index();
            $('.active .btn_next').parents('.wizard-pane').next().addClass('active').siblings().removeClass('active');
        }
        $('.pearls .pearl').eq(index).addClass('done').removeClass('current').next().addClass('current').removeClass('disabled');
        $('body,html').animate({
            scrollTop: 0
        },0);
        //获取规格id存储
        var g_standard = '';
        $('#xxl_gnarr').find("input[type = 'checkbox']").each(function () {
            g_standard = g_standard+$(this).val()+',';
        });
        $('#g_standard').val(g_standard);//规格id
    }
    //   input框必填方法
    function input_required(e) {
        if(e){
            if(e.val()==''){
                e.parents('.form-bolck').addClass('has-error');
                e.parent().find('#uei_operate_time-error').css('display','inline-block');
                $('.active .btn_next').attr({"disabled":"disabled"});
                inp_ = false;
            }else{
                e.parents('.form-bolck').removeClass('has-error').addClass('has-success');
                e.parent().find('#uei_operate_time-error').css('display','none');
                $('.active .btn_next').removeAttr("disabled");
                inp_ = true;
            }
        }else {
          next();
        }

    }
    //  下拉框必填判断
    function selectJudge(e,b) {
        if(e.val()>0){
            b.removeAttr("disabled");
        }else{
            b.attr({"disabled":"disabled"});
        }
    }

    //  input框失去焦点判断
    $('*[required]').blur(function(){
        input_required($(this));
    });

    //    点击删除tr
    $('.table_add').delegate('.del_btn', 'click', function(){
        $(this).parents('tr').remove();
    });
    //   点击下一步按钮页面回到最顶部

    $(".wizard-content").delegate(".active .btn_next","click",function(){
        next();
    });
    //  图片信息上传判断
    $('.btn_next_two').click(function () {
        var imgLen = $('.image').length;
        var acitve_val = $('input:radio[name="is_join_activity"]:checked').val();
        if(imgLen<=1){
            alert("请上传商品图片！");
            return false;
        } else if(acitve_val==null){
           alert("请选择满减活动是否参与！");
            return false;
        }else if($("#goods_photo_src").css('display') == 'none'){
            alert("请选择商品头图！");
            return false;
        }else {
            if($('.active *[required]').length>0){
                for(var i=0;i<$('.active *[required]').length;i++){
                    input_required($('.active *[required]').eq(i));
                    if(inp_ === true){
                        $('.active .btn_next').addClass('required_success');
                    }else{
                        $('.active .btn_next').removeClass('required_success');
                    }
                }
                next($('.required_success'))
            }else{
                input_required();
            }
        }
    });
    //下一步判断是否有商品规格
    $('.xxl_next').click(function(){
        var spec = $('#xxl_gnarr').find('input[name="gn_id"]');
        if(spec.length < 1){
            alert("<font color='red'>请添加商品规格！</font>");
            return false;
        }
    });

    //  点击上一步
    $('.btn_back').click(function () {
        var index = $(this).parents('.wizard-pane').index();
        $(this).parents('.wizard-pane').prev().addClass('active').siblings().removeClass('active');
        $('.pearls .pearl').eq(index).addClass('disabled').removeClass('done current').prev().addClass('current done').removeClass('disabled')
        $('body,html').animate({
            scrollTop: 0
        },0);
    });

    function getlowerLevel(select,v) {
        fajax("/goods/get_lower_level.html", 'select=' + select+ '&v=' + v, 'post', 'html',function (data) {
            data = '<option value="0">--请选择二级分类--</option>' + data;
            $("#classification2").html(data);
            $("#classification2").chosen();
            $("#classification2").trigger("chosen:updated");
        });
    }
    function getThreelowerLevel(select,v) {
        fajax("/goods/get_lower_level.html", 'select=' + select+ '&v=' + v, 'post', 'html',function (data) {
            data = '<option value="0">--请选择三级分类--</option>' + data;
            $("#classification3").html(data);
            $("#classification3").chosen();
            $("#classification3").trigger("chosen:updated");
        })
    }
    function getAttributeInfo(select,v) {
        fajax("/goods/get_attribute_info.html", 'select=' + select+ '&v=' + v, 'post', 'html',function (data) {
            $("#xxl_gc_attribute").html(data);
        })
    }

    // 二级分类选择
    $('#classification1').change(function () {
        var vv = $(this).val();
        getlowerLevel(vv);
        getAttributeInfo(vv,0);
    });
    // 三级分类选择
    $('#classification2').change(function () {
        var vv = $(this).val();
        getThreelowerLevel(vv)
    });

    // 添加规格信息
    function addSpec() {
        mopen("/goods/edit_spec_price.html?gn_id=add", '添加规格信息', null, ['680px', '500px'], function (e, d) {
            fsubmit($("#addSpecForm"), optPartnerForm);
        });
    }

    // 编辑规格信息
    function editSpec() {
        var len = $("input[name='gn_id']:checked").length;
        if (len > 1) {
            alert("最多只能选择一个！");
            return false;
        } else if (len == 0) {
            alert("请选择要编辑的规格信息！");
            return false;
        }
        var gn_id = $("input[name='gn_id']:checked")[0].value;
        var url = "/goods/edit_spec_price.html?gn_id=" + gn_id;
        mopen(url, '修改规格信息', null, ['680px', '500px'], function (e, d) {
            fsubmit($("#addSpecForm"), optPartnerForm);
        });
    }
    function optPartnerForm(data) {
        if(data.code == 200){
            alert(data.msg);
        }else{
            alert(data.msg);return;
        }
        if (data.act == "add") {
            if (data.code == "200") {
                layer.closeAll('page');
                var html = "";
                html = '<tr>' +
                    ' <td><input type="checkbox" name="gn_id" value="' + data.data.gn_id + '" /></td>' +
                    ' <td>' + data.data.gn_spec_type + '</td>' +
                    ' <td>' + data.data.gn_spec_num + '</td>' +
                    ' <td>' + data.data.gn_price + '</td>' +
                    ' <td>' + data.data.curr_stock + '</td>' +
                    ' <td>' + data.data.gn_stock + '</td>' +
                    ' <td>' + data.data.gn_stock_remind + '</td>' +
                    '</tr>';
                //添加信息
                $(".xxlEditSpec").append(html);
            }
        } else if (data.act == "edit") {
            if (data.code == "200") {
                layer.closeAll('page');
                var bankInput = $("input[name='gn_id']:checked")[0];
                var bankStr = $(bankInput).closest("tr");
                $(bankStr).find("td").eq(1).text(data.data.gn_spec_type);
                $(bankStr).find("td").eq(2).text(data.data.gn_spec_num);
                $(bankStr).find("td").eq(3).text(data.data.gn_price);
                $(bankStr).find("td").eq(4).text(data.data.curr_stock);
                $(bankStr).find("td").eq(5).text(data.data.gn_stock);
                $(bankStr).find("td").eq(6).text(data.data.gn_stock_remind);
            }
        }
    }

    // 删除资料
    $(".file-box").delegate(".cancel","click",function(){
        obj = new Object();
        obj.id = $(this).attr('data-id');
        obj.p_type = $(this).attr('data-type');
        var that = $(this);
        if(!stopFresh()){
            return false;
        }
        fajax('/upload/del.html',obj,'post','json',function(d){
            if(200 == d.code){
                that.parent().remove();
            }else if(201 == d.code){
                that.parent().remove();
            }
            alert(d.msg);
        });
    });

    // 删除图片-上传时
    $(".file_list").delegate(".delGcate","click",function(){
        alert('删除成功');
        $(this).parent().remove();
    });

    function intopiece_submit(){
        var time_radio = $('input:radio[name="g_status"]:checked').val();
        var inp_check = $("input[name='inputCheckboxes']").is(':checked');
        var gstatus = '{{ goods_data.gStatus }}';
        if(gstatus == ''){
            if(time_radio==null){
                alert('请选择上架时间!');
                return false;
            }else if(!inp_check){
                alert('请仔细阅读《商品发布规格》，并选择已阅读！');
                return false;
            }
        }
        fsubmit($("#addGoodsForm"),function(data){
            alert(data.msg)
            if(data.code == 200) {
                close_tab();
                window.location.href = data.openUrl;
            }
        });
    }

    function goods_upload(e) {
        if(!/.+\.(jpg|jpeg|gif|png)/.test($("#goods_photo").val())){
            alert('图片格式不正确，请选择正确的图片!');
        }else{
            var reader = new FileReader();
            var file = e.target.files[0];
            var size = file.size;//字节
            var max_size = 10*1024*1024;// 10M
            if(size > max_size){
                alert('<font color="red">图片大小不能超过10M</font>');return;
            }
            var file_base64 = '';
            reader.readAsDataURL(file);
            var ext = file.type.substring(6);
            reader.onload=function(file){
                file_base64 = file.target.result;
                $('#goods_photo_').val(file_base64);
                $("#goods_ext").val(ext);
            }
            setTimeout(function () {
                $('#goods_photo_form').ajaxSubmit({
                    url:"{{ admin_bundle.charUpload }}",
                    headers:{'Authorization':hex_md5(data_str)},
                    beforeSubmit:function(a,b,c){
                        backOff(true);
                    },
                    success:function(data){
                        if(2000 == data.status){
                            $("#goods_photo_src").attr("src", '{{ admin_bundle.fileHost }}'+data.result.url);
                            $("#goods_photo_src").css("display",'block');
                            $('#goodsHeadImg').val(data.result.url);
                            $("#goods_photo_src").show();
                            $('#del_photo').removeAttr('disabled')
                        }
                        backOff(false);
                    },
                    error : function(result) {
                        msg('上传失败!');
                        backOff(false);
                    },
                    resetForm:false,
                    dataType:'json'
                });},350);
            return false;
        }
    }
    function gdel_upload(){
        alert('删除成功');
        $('#del_photo').attr('disabled','disabled')
        $('#goodsHeadImg').val('');
        $("#goods_photo_src").attr("src",'');
        $("#goods_photo_src").css("display",'none');
        $('#goods_photo_').val('');
        $("#goods_ext").val('');
        $("#goods_photo").val('');
    }
</script>